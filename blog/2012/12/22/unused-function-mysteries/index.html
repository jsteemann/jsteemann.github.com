
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Unused function C compiler mysteries - blog4j</title>
  <meta name="author" content="jsteemann">

  
  <meta name="description" content="Today I stumbled across an issue when compiling C code with unused functions. Some simple test program demonstrates the issue: 1
2
3
4
5
6
7
8
9
10 &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://jsteemann.github.com/blog/2012/12/22/unused-function-mysteries/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="blog4j" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">blog4j</a></h1>
  
    <h2>Some random tech notes</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:jsteemann.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Unused Function C Compiler Mysteries</h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-12-22T03:51:00+01:00" pubdate data-updated="true">Dec 22<span>nd</span>, 2012</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>Today I stumbled across an issue when compiling C code with unused functions.</p>

<p>Some simple test program demonstrates the issue:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="c1">// this function is not used</span>
</span><span class='line'><span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">NotUsedInline</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// this function is not used either</span>
</span><span class='line'><span class="k">static</span> <span class="kt">void</span> <span class="nf">NotUsed</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">main</span> <span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
</span><span class='line'>  <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="n">argc</span><span class="p">;</span>
</span><span class='line'>  <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="n">argv</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>When compiling the above code with gcc (4.6.3), it warns about the function <em>NotUsed</em> being defined, but not unused:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="n">gcc</span> <span class="o">-</span><span class="n">Wall</span> <span class="o">-</span><span class="n">Wextra</span> <span class="n">test</span><span class="p">.</span><span class="n">c</span>
</span><span class='line'><span class="n">test</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">6</span><span class="o">:</span><span class="mi">13</span><span class="o">:</span> <span class="n">Warnung</span><span class="o">:</span> <span class="err">»</span><span class="n">NotUsed</span><span class="err">«</span> <span class="n">definiert</span><span class="p">,</span> <span class="n">aber</span> <span class="n">nicht</span> <span class="n">verwendet</span> <span class="p">[</span><span class="o">-</span><span class="n">Wunused</span><span class="o">-</span><span class="n">function</span><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is fine, however, the compiler does not warn about the function <em>NotUsedInline</em> not being used either.
This warning is simply ommitted.</p>

<p>When compiling with clang (3.0.6), the result is the same. The compiler will only complain about the non-static
function being unused:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="n">clang</span> <span class="o">-</span><span class="n">Wall</span> <span class="o">-</span><span class="n">Wextra</span> <span class="n">test</span><span class="p">.</span><span class="n">c</span>
</span><span class='line'><span class="n">test</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">6</span><span class="o">:</span><span class="mi">13</span><span class="o">:</span> <span class="n">warning</span><span class="o">:</span> <span class="n">unused</span> <span class="n">function</span> <span class="err">&#39;</span><span class="n">NotUsed</span><span class="err">&#39;</span> <span class="p">[</span><span class="o">-</span><span class="n">Wunused</span><span class="o">-</span><span class="n">function</span><span class="p">]</span>
</span><span class='line'><span class="k">static</span> <span class="kt">void</span> <span class="n">NotUsed</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="o">^</span>
</span><span class='line'><span class="mi">1</span> <span class="n">warning</span> <span class="n">generated</span><span class="p">.</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is the same for all optimisation levels, at least O0 to O3.</p>

<p>Both compilers do not generate code for <em>NotUsedInline</em>. So they must have detected the function is unused.</p>

<p>It would be nice to get a warning from the compiler for every static function that is unused, no matter if declared inline or not.
I don&#8217;t like maintaining functions that are never called.</p>

<p>When looking at the assembly output I noticed that clang also avoids code generation for the other unused function, even with optimisation level O0.
gcc generates the code for it on O0 though it is fully unnecessary. gcc will not emit the code for the unused function on higher optimisation levels.</p>

<p>Still +1 for clang.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">jsteemann</span></span>

      








  


<time datetime="2012-12-22T03:51:00+01:00" pubdate data-updated="true">Dec 22<span>nd</span>, 2012</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/c/'>c</a>, <a class='category' href='/blog/categories/compilers/'>compilers</a>, <a class='category' href='/blog/categories/gcc/'>gcc</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://jsteemann.github.com/blog/2012/12/22/unused-function-mysteries/" data-via="steemann" data-counturl="http://jsteemann.github.com/blog/2012/12/22/unused-function-mysteries/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2012/12/19/setting-up-octopress/" title="Previous Post: Setting up Octopress">&laquo; Setting up Octopress</a>
      
      
        <a class="basic-alignment right" href="/blog/2012/12/25/using-callgrind-control-on-ubuntu/" title="Next Post: Using callgrind_control on Ubuntu">Using callgrind_control on Ubuntu &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2012/12/25/using-callgrind-control-on-ubuntu/">Using callgrind_control on Ubuntu</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/12/22/unused-function-mysteries/">Unused function C compiler mysteries</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/12/19/setting-up-octopress/">Setting up Octopress</a>
      </li>
    
  </ul>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating...</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("steemann", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/steemann" class="twitter-follow-button" data-show-count="false">Follow @steemann</a>
  
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - jsteemann -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
